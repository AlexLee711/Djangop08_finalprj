<!-- forum.html (Final_PRJ) -->
{% extends "base.html" %}
{% block title %} å¤©å¤©èª¼å®¶å…¬å¯“ç®¡ç†ç¶²{% endblock %}
{% block content %}
<!-- é€™è£¡æ”¾æˆ‘å€‘è¦å‘ˆç¾çš„å…§å®¹-->
<div class='container'>
    {% if message %}
    <div class='alert alert
    warning'>{{ message }}</div>
    {% endif %}
    <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title"><a href="#collapsepost" data-toggle="collapse">å¼µè²¼è­°é¡Œè¨è«–è²¼æ–‡</a></h4>
        </div>
        <div id="collapsepost" class="panel-collapse collapse">
            <div class="panel-body">
                <form name='my form' action='.' method='POST'>
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="id_title">æ¨™é¡Œï¼š</label>
                        {{ forum_form.title}}
                    </div>
                    <div class="form-group">
                        <label for="id_body">å…§æ–‡ï¼š</label>
                        {{ forum_form.body}}
                    </div>
                    <div class="form-group">
                        <label for="id_posttime">ç™¼å¸ƒæ™‚é–“ï¼š</label>
                        {{ forum_form.posttime}}
                    </div>
                    <br />
                    <input type='submit' value='å¼µè²¼' class="btn btn-info">
                    <input type='reset' value='æ¸…é™¤é‡å¡«' class="btn btn-danger">
                </form>
            </div>
        </div>
    </div>
    <hr>
    <div class='row'>
        <div class='col-md-12'>
            <div class='panel panel-default'>
                <div class='panel-heading' align=center>
                    <h1>ç¤¾å€è­°é¡Œè¨è«–</h1>
                </div>
            </div>
        </div>
    </div>
    {% for forum in forums %}
    {% cycle "<div class='row'>" "" "" %}
        <div class='col-md-4'>
            <div class='panel panel-primary'>
                <div class='panel-heading' align=center>
                    {{ forum.title }}
                </div>
                <div class='panel-body'>
                    {{ forum.body | linebreaks }}
                    <hr>
                    <h4><a data-toggle="collapse" data-target="#commentsCollapse{{ forum.id }}" style="cursor: pointer;">æŸ¥çœ‹ç•™è¨€ï¼š</a></h4>
                    <div id="commentsCollapse{{ forum.id }}" class="collapse">
                    <ul>
                    {% for comment in forum.comments.all %}
                        <li><strong>{{ comment.user.username }}</strong>: {{ comment.body }} ({{ comment.posttime }})</li>
                        
                        {% if request.user == comment.user%}
                        <form method="POST" action="{% url 'delete_comment' comment.id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-link text-danger p-0">ğŸ—‘ï¸ åˆªé™¤</button>
                        </form>
                        
                        {% endif %}
                        {% empty %}
                            <p>å°šç„¡ç•™è¨€</p>
                    {% endfor %}
                </ul>
                </div>
                <br>
                <form method="POST" action=".">
                    {% csrf_token %}
                    <div class="form-group">
                        <div class="form-group">
                            {{ comment_form.body}}
                        </div>
                    </div>
                    <input type="hidden" name="forum_id" value="{{ forum.id }}">
                    <input type="submit" name="comment_submit" value="ç™¼è¡¨ç•™è¨€" class="btn btn-primary">
                </form>
            </div>

                <div class='panel-footer'>
                    <small>ç™¼å¸ƒäººï¼š{{ forum.user }} / </small>
                    <small>ç™¼å¸ƒæ™‚é–“ï¼š{{ forum.posttime }}</small>
            {% if request.user == forum.user%}
            <span class="glyphicon glyphicon-trash" onclick='go_delete({{forum.id}})' style="cursor: pointer; float: right;" ></span><!--onclick='go_delete({{diary.id}})'-->
            {% endif %}
        </div>
    </div>
</div>    
{% endfor %}
</div>
    <!--{% if messages %}
            <script>
                {% for msg in messages%}
                    alert('{{ msg.message}}');
                {% endfor %}
            </script>
    {% endif %}-->
    <script>
        function go_delete(id){
            var confrimation = confirm("ä½ ç¢ºå®šè¦åˆªé™¤é€™å€‹è²¼æ–‡æˆ–ç•™è¨€å—ï¼Ÿ");
            if(confrimation){
                var usr = '/'+ id +'/';
                window.location = usr;
            }
            
        }
    </script>
{% endblock %}